# Поиск изображений по запросу  

### Описание проекта  
Вам поручено разработать демонстрационную версию поиска изображений по запросу.

Для демонстрационной версии нужно обучить модель, которая получит векторное представление изображения, векторное представление текста, а на выходе выдаст число от 0 до 1 — покажет, насколько текст и картинка подходят друг другу.

Данные лежат в папке `/datasets/image_search/`.  

В файле `train_dataset.csv` находится информация, необходимая для обучения: имя файла изображения, идентификатор описания и текст описания. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат `<имя файла изображения>#<порядковый номер описания>`.

В папке `train_images` содержатся изображения для тренировки модели.

В файле `CrowdAnnotations.tsv` — данные по соответствию изображения и описания, полученные с помощью краудсорсинга. Номера колонок и соответствующий тип данных:

1. Имя файла изображения.
2. Идентификатор описания.
3. Доля людей, подтвердивших, что описание соответствует изображению.
4. Количество человек, подтвердивших, что описание соответствует изображению.
5. Количество человек, подтвердивших, что описание не соответствует изображению.

В файле `ExpertAnnotations.tsv` содержатся данные по соответствию изображения и описания, полученные в результате опроса экспертов. Номера колонок и соответствующий тип данных:

1. Имя файла изображения.
2. Идентификатор описания.

3, 4, 5 — оценки трёх экспертов.

Эксперты ставят оценки по шкале от 1 до 4, где 1 — изображение и запрос совершенно не соответствуют друг другу, 2 — запрос содержит элементы описания изображения, но в целом запрос тексту не соответствует, 3 — запрос и текст соответствуют с точностью до некоторых деталей, 4 — запрос и текст соответствуют полностью.

В файле `test_queries.csv` находится информация, необходимая для тестирования: идентификатор запроса, текст запроса и релевантное изображение. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат `<имя файла изображения>#<порядковый номер описания>`.

В папке `test_images` содержатся изображения для тестирования модели.  

### Описание данных.  

**train_dataset.csv**  
`image` - имя файла изображения  
`query_id` - идентификатор описания  
`query_text` - текст описания  

**CrowdAnnotations.tsv**  
`image` - имя файла изображения    
`query_id` - идентификатор описания  
`true_frac` - доля людей, подтвердивших, что описание соответствует изображению  
`true_cnt` - количество человек, подтвердивших, что описание соответствует изображению  
`false_cnt` - количество человек, подтвердивших, что описание не соответствует изображению

**ExpertAnnotations.tsv**  
`image` - имя файла изображения  
`query_id` - идентификатор описания  
`first_exp` - оценка первого эксперта  
`second_exp` - оценка второго эксперта  
`third_exp` - оценка третьего эксперта  

**Ход исследования**:  
---
-  **Выполнен исследовательский анализ данных**
    - пропуски и явные дубликаты в данных отсутствуют;
    - добавили столбец `exp_mean_score`, содержащий агрегированное значение оценок эскпертов, и масштабировали его от 0 до 1 с помощью класса `MinMaxScaler`. 
    - объединили оценки, полученные с помощью краудсорсинга и экспертов
    - показали, что оценки, полученные с помощью краудсорсинга и экспертов сильно коррелируют
    - выбрали для дальнейшего обучения оценки, полученные с помощью экспертов несмотря на их меньшее количество
    - обучающая выборка содержит 977 уникальных текстов и 1000 уникальных изображений;  
    - основываясь на оценках экспертов и данных, собранных с помощью краудсорсинга, можно сделать вывод, что большая часть текстов в наборе данных не соответствуют изображению;  
---
- **Проверка данных**
    - составлен список запрещённых слов и на основании составленного списка запрещённых слов удалены объекты, которые могут нарушать ограничения по обработке изображений;  
    - тексты очищены от знаков препинания, переведены в нижний регистр и лемматизированы;  
---
- **Векторизация изображений и текстов**
    - для векторизации изображений использовалась архитектура `ResNet-18`, тексты были переведены в вектор с помощью модели `BERT`;  
---
- **Обучение и тестирование модели**
    - данные разделены на обучающую и тестовую выборки в соотношении 7:3;
    - выполнено обучение трёх моделей: `линейной регрессии`, `нейронной сети` и `градиентного бустинга`;
    - для оценки качества модели выбрана метрика `RMSE`;
    - на кросс-валидации лучший результата продемонстрировала модель градиентного бустинга (`RMSE` = 0.248), поэтому была выбрана для финального тестирования; 
    - значение метрики `RMSE`, полученное на валидационной выборке: 0.227;  
    - для более качественного подбора изображений была использована нейронная сеть `CLIP`.
